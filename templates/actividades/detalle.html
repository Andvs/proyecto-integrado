{% extends "inicio.html" %}

{% block page_title %}Detalle de la actividad{% endblock %}

{% block main %}
<div class="container-fluid" style="max-width: 1100px;">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">{{ actividad.titulo }}</h4>
    <a href="{% url 'actividades_lista' %}" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Volver
    </a>
  </div>

  <!-- Información de la actividad -->
  <div class="card card-soft mb-4">
    <div class="card-body">
      <div class="row">
        <div class="col-md-3">
          <p class="mb-2"><strong>Tipo:</strong></p>
          {% if actividad.tipo == "ENTRENAMIENTO" %}
            <span class="badge bg-primary fs-6">{{ actividad.get_tipo_display }}</span>
          {% elif actividad.tipo == "PARTIDO" %}
            <span class="badge bg-warning text-dark fs-6">{{ actividad.get_tipo_display }}</span>
          {% else %}
            <span class="badge bg-success fs-6">{{ actividad.get_tipo_display }}</span>
          {% endif %}
        </div>
        <div class="col-md-3">
          <p class="mb-2"><strong>Fecha de inicio:</strong></p>
          <p class="mb-0">{{ actividad.fecha_inicio|date:"d/m/Y" }}</p>
        </div>
        <div class="col-md-3">
          <p class="mb-2"><strong>Fecha de fin:</strong></p>
          <p class="mb-0">{{ actividad.fecha_fin|date:"d/m/Y" }}</p>
        </div>
        <div class="col-md-3">
          <p class="mb-2"><strong>Duración:</strong></p>
          <p class="mb-0">
            {% widthratio actividad.fecha_fin|date:"j" 1 1|add:actividad.fecha_inicio|date:"j"|add:"-1"|default:"0" as dias %}
            {% if dias == 0 %}1 día{% else %}{{ dias }} días{% endif %}
          </p>
        </div>
      </div>

      {% if actividad.descripcion %}
        <div class="mt-3">
          <p class="mb-2"><strong>Descripción:</strong></p>
          <p class="mb-0">{{ actividad.descripcion }}</p>
        </div>
      {% endif %}

      <div class="mt-3">
        <a href="{% url 'actividades_editar' actividad.id %}" class="btn btn-sm btn-primary">
          <i class="bi bi-pencil-square"></i> Editar actividad
        </a>
      </div>
    </div>
  </div>

  <!-- Equipos participantes -->
  <div class="card card-soft mb-4">
    <div class="card-header bg-white">
      <h5 class="mb-0">Equipos participantes ({{ actividad.equipos.count }})</h5>
    </div>
    <div class="card-body p-0">
      {% with equipos=actividad.equipos.all %}
        {% if equipos %}
          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Equipo</th>
                  <th>Categoría</th>
                  <th>Entrenador</th>
                  <th>N° Jugadores</th>
                </tr>
              </thead>
              <tbody>
                {% for equipo in equipos %}
                  <tr>
                    <td><strong>{{ equipo.nombre }}</strong></td>
                    <td><span class="badge bg-info">{{ equipo.categoria }}</span></td>
                    <td>{{ equipo.entrenador.nombre_completo }}</td>
                    <td class="text-center">
                      <span class="badge bg-success">{{ equipo.jugadores.count }}</span>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <div class="p-4 text-center text-muted">
            No hay equipos asignados a esta actividad.
          </div>
        {% endif %}
      {% endwith %}
    </div>
  </div>

  <!-- Lista de jugadores participantes -->
  <div class="card card-soft">
    <div class="card-header bg-white">
      <h5 class="mb-0">Jugadores participantes ({{ jugadores_totales|length }})</h5>
    </div>
    <div class="card-body p-0">
      {% if jugadores_totales %}
        <div class="table-responsive">
          <table class="table align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th>Nombre completo</th>
                <th>Equipo</th>
                <th>RUN</th>
                <th>Teléfono</th>
              </tr>
            </thead>
            <tbody>
              {% for jugador in jugadores_totales %}
                <tr>
                  <td>
                    <strong>{{ jugador.perfil.nombre_completo }}</strong>
                  </td>
                  <td>{{ jugador.equipo.nombre }}</td>
                  <td>{{ jugador.perfil.run }}</td>
                  <td>{{ jugador.perfil.telefono|default:"—" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <div class="p-4 text-center text-muted">
          <i class="bi bi-info-circle fs-1"></i>
          <p class="mt-2 mb-0">No hay jugadores activos en los equipos participantes.</p>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}