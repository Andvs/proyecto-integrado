{% extends "base.html" %}
{% load static %}

{% block titulo %}{% block page_title %}Dashboard{% endblock %}{% endblock %}

{% block contenido %}

<style>
  .layout {
    display: grid;
    grid-template-columns: 240px 1fr;
    min-height: 100vh;
  }
  .sidebar {
    background: #0a84c1; color: #fff; position: sticky; top: 0;
    height: 100vh; padding: 1rem 0.75rem;
  }
  .brand {
    display:flex; align-items:center; gap:.5rem; padding:.25rem .5rem .75rem;
    border-bottom: 1px solid rgba(255,255,255,.15); margin-bottom:.75rem;
  }
  .brand img { height: 34px; }
  .menu a {
    display:flex; align-items:center; gap:.6rem; color:#eaf6fc; text-decoration:none;
    padding:.6rem .75rem; border-radius:.5rem; transition:.15s;
  }
  .menu a:hover { background: rgba(255,255,255,.12); color:#fff; }
  .menu a.active { background:#fff; color:#0a84c1; font-weight:600; }
  .menu .section-title { font-size:.75rem; opacity:.8; margin:.75rem .5rem .25rem; }
  .page { background:#f5f7fb; }
  .topbar-inner {
    background:#eef1f6; border-bottom:1px solid #e1e6ef;
    display:flex; align-items:center; gap:.75rem; padding:.6rem .75rem;
  }
  .topbar-inner .search { flex:1; }
  .topbar-inner input { border:0; background:#fff; }
  .content { padding:1rem; }
  .card-soft { border:0; box-shadow: 0 6px 18px rgba(18,38,63,.06); border-radius:.75rem; }
  @media (max-width: 992px){
    .layout { grid-template-columns: 72px 1fr; }
    .brand span, .menu a span { display:none; }
  }
</style>

<div class="layout">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="brand">
      <img src="{% static 'img/nuevo_logo.png' %}" alt="Logo">
      <span>Sur Volley</span>
    </div>

    <nav class="menu">
      <div class="section-title">General</div>

      <a href="{% url 'dashboard' %}"
         class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
        <i class="bi bi-grid-1x2"></i><span>Dashboard</span>
      </a>

      {% if user.is_authenticated %}
        {# ===== SUPERUSUARIO: siempre ve Administración aunque no tenga Perfil ===== #}
        {% if user.is_superuser %}
          <div class="section-title">Administración</div>
          <a href="{% url 'usuarios_lista' %}" class="{% if request.resolver_match.url_name == 'usuarios_lista' %}active{% endif %}">
            <i class="bi bi-person-gear"></i><span>Usuarios</span>
          </a>
          <a href="#"><i class="bi bi-people"></i><span>Jugadores</span></a>
          <a href="#"><i class="bi bi-shield"></i><span>Equipos</span></a>
          <a href="#"><i class="bi bi-calendar-event"></i><span>Actividades</span></a>
          <a href="#"><i class="bi bi-clipboard-check"></i><span>Asistencias</span></a>
          <a href="#"><i class="bi bi-graph-up"></i><span>Reportes</span></a>
        {% elif user.perfil %}
          {% with tipo=user.perfil.tipo %}
            {# ======================= ADMIN / EQUIPO ADMIN ======================= #}
            {% if tipo == "ADMIN" or tipo == "EQUIP" %}
              <div class="section-title">Administración</div>
              <a href="{% url 'usuarios_lista' %}" class="{% if request.resolver_match.url_name == 'usuarios_lista' %}active{% endif %}">
                <i class="bi bi-person-gear"></i><span>Usuarios</span>
              </a>
              <a href="{% url 'jugadores_lista' %}" class="{% if request.resolver_match.url_name == 'jugadores_lista' %}active{% endif %}">
                <i class="bi bi-people"></i><span>Jugadores</span>
              </a>
              <a href="{% url 'entrenadores_lista' %}" class="{% if request.resolver_match.url_name == 'entrenadores_lista' %}active{% endif %}">
                <i class="bi bi-person-badge"></i><span>Entrenadores</span>
              </a>
              <a href="{% url 'equipos_lista' %}" class="{% if request.resolver_match.url_name == 'equipos_lista' %}active{% endif %}">
                <i class="bi bi-shield"></i><span>Equipos</span>
              </a>
              <a href="{% url 'actividades_lista' %}" class="{% if request.resolver_match.url_name == 'actividades_lista' %}active{% endif %}">
                <i class="bi bi-calendar-event"></i><span>Actividades</span>
              </a>
              <a href="{% url 'asistencias_lista' %}" class="{% if request.resolver_match.url_name == 'asistencias_lista' %}active{% endif %}">
                <i class="bi bi-clipboard-check"></i><span>Asistencias</span>
              </a>
              <a href="#"><i class="bi bi-graph-up"></i><span>Reportes</span></a>
            {% endif %}

            {# ============================ ENTRENADOR ============================ #}
            {% if tipo == "ENTRE" %}
              <div class="section-title">Entrenador</div>
              <a href="{% url 'dashboard' %}"><i class="bi bi-people"></i><span>Mis equipos</span></a>
              <a href="#"><i class="bi bi-clipboard-check"></i><span>Registrar asistencia</span></a>
              <a href="#"><i class="bi bi-calendar-event"></i><span>Actividades próximas</span></a>
            {% endif %}

            {# ============================= JUGADOR ============================== #}
            {% if tipo == "JUGAD" %}
              <div class="section-title">Jugador</div>
              <a href="{% url 'dashboard' %}"><i class="bi bi-calendar2-check"></i><span>Mis actividades</span></a>
              <a href="#"><i class="bi bi-stopwatch"></i><span>Mis entrenamientos</span></a>
            {% endif %}

            {# ============================== SOCIO =============================== #}
            {% if tipo == "SOCIO" %}
              <div class="section-title">Socio</div>
              <a href="{% url 'dashboard' %}"><i class="bi bi-info-circle"></i><span>Comunicados</span></a>
            {% endif %}
          {% endwith %}
        {% endif %}

        <div class="section-title">Sistema</div>
        <a href="#"><i class="bi bi-person"></i><span>Perfil</span></a>
        <a href="{% url 'logout' %}"><i class="bi bi-box-arrow-right"></i><span>Salir</span></a>
      {% endif %}
    </nav>
  </aside>

  <!-- CONTENIDO -->
  <section class="page">
    <div class="topbar-inner">
      <button class="btn btn-sm btn-outline-secondary d-lg-none" type="button"
              onclick="document.body.classList.toggle('sb-open')">
        <i class="bi bi-list"></i>
      </button>

      <div class="search">
        <input class="form-control" placeholder="{% block page_placeholder %}Buscar...{% endblock %}">
      </div>

      <div class="d-flex align-items-center gap-2">
        <span class="text-muted small d-none d-md-inline">
          {% if user.is_authenticated %}
            {% if user.perfil %}
              Hola, {{ user.perfil.primer_nombre }} {{ user.perfil.apellido_paterno }}
              {% if user.perfil.tipo %} · {{ user.perfil.get_tipo_display }}{% endif %}
            {% elif user.is_superuser %}
              Hola, {{ user.username }} · Superusuario
            {% else %}
              Hola, {{ user.username }}
            {% endif %}
          {% else %}
            Hola
          {% endif %}
        </span>
        <a class="btn btn-light btn-sm rounded-circle" href="#">
          <i class="bi bi-person-circle"></i>
        </a>
      </div>
    </div>

    <div class="content">
      {% block main %}{% endblock %}
    </div>
  </section>
</div>

{% endblock %}
